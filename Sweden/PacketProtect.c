/* This file was generated by the Hex-Rays decompiler.
   Copyright (c) 2007-2020 Hex-Rays <info@hex-rays.com>

   Detected compiler: Visual C++
*/

#include <defs.h>


//-------------------------------------------------------------------------
// Function declarations

#define __thiscall __cdecl // Test compile in C mode

int _E4();
CFvCrc32 *_E1();
int _E3();
void __cdecl _E2(); // idb
int __cdecl InitPacketProtect(char *a1);
int *__cdecl SeedEncRoundKey(int *a1, unsigned __int8 *a2);
unsigned int __cdecl PPEncryptClientPacket(unsigned __int8 *a1, unsigned int a2, int a3);
int __cdecl SeedEncrypt(unsigned __int8 *a1, unsigned int a2, int a3);
unsigned __int8 *__cdecl SeedEncryptBlock(unsigned __int8 *a1, int a2);
int __cdecl PPDecryptServerPacket(unsigned __int8 *, unsigned int); // idb
int __cdecl SeedDecrypt(int a1, int a2, int *a3);
unsigned __int8 *__cdecl SeedDecryptBlock(unsigned __int8 *a1, int *a2);
int __cdecl PPDecryptClientPacket(unsigned __int8 *, unsigned int); // idb
int PPGetLastError();
// CFvCrc32 *__thiscall CFvCrc32::CFvCrc32(CFvCrc32 *__hidden this); idb
// int __cdecl atexit(void (__cdecl *)());
// void __thiscall CFvCrc32::~CFvCrc32(CFvCrc32 *__hidden this); idb
// void __cdecl _srand(unsigned int Seed);
// __time32_t __cdecl _time(__time32_t *const Time);
// bool __thiscall CFvCrc32::Crc32Mem(CFvCrc32 *__hidden this, unsigned __int8 *, unsigned int, unsigned int *); idb
// int __cdecl _rand();

//-------------------------------------------------------------------------
// Data declarations

_UNKNOWN crc; // weak
int clientRoundKey[32]; // idb
int serverRoundKey[32]; // idb
int dwPPLastError; // weak
int SS0[256] =
{
  696885672,
  92635524,
  382128852,
  331600848,
  340021332,
  487395612,
  747413676,
  621093156,
  491606364,
  54739776,
  403181592,
  504238620,
  289493328,
  1020063996,
  181060296,
  591618912,
  671621160,
  71581764,
  536879136,
  495817116,
  549511392,
  583197408,
  147374280,
  386339604,
  629514660,
  261063564,
  50529024,
  994800504,
  999011256,
  318968592,
  314757840,
  785310444,
  809529456,
  210534540,
  1057960764,
  680042664,
  839004720,
  500027868,
  919007988,
  876900468,
  751624428,
  361075092,
  185271048,
  390550356,
  474763356,
  457921368,
  1032696252,
  16843008,
  604250148,
  470552604,
  860058480,
  411603096,
  268439568,
  214745292,
  851636976,
  432656856,
  738992172,
  667411428,
  843215472,
  58950528,
  462132120,
  297914832,
  109478532,
  164217288,
  541089888,
  272650320,
  595829664,
  734782440,
  218956044,
  914797236,
  512660124,
  256852812,
  931640244,
  441078360,
  113689284,
  944271480,
  646357668,
  302125584,
  797942700,
  365285844,
  557932896,
  63161280,
  881111220,
  21053760,
  306336336,
  1028485500,
  227377548,
  134742024,
  521081628,
  428446104,
  0,
  420024600,
  67371012,
  323179344,
  935850996,
  566354400,
  1036907004,
  910586484,
  789521196,
  654779172,
  813740208,
  193692552,
  235799052,
  730571688,
  578986656,
  776888940,
  327390096,
  223166796,
  692674920,
  1011642492,
  151585032,
  168428040,
  1066382268,
  802153452,
  868479984,
  96846276,
  126321540,
  335810580,
  1053750012,
  608460900,
  516870876,
  772678188,
  189481800,
  436867608,
  101057028,
  553722144,
  726360936,
  642146916,
  33686016,
  902164980,
  310547088,
  176849544,
  202113036,
  864269232,
  1045328508,
  281071824,
  977957496,
  122110788,
  377918100,
  633725412,
  637936164,
  8421504,
  764256684,
  533713884,
  562143648,
  805318704,
  923218740,
  781099692,
  906375732,
  352653588,
  570565152,
  940060728,
  885321972,
  663200676,
  88424772,
  206323788,
  25264512,
  701096424,
  75792516,
  394761108,
  889532724,
  197903304,
  248431308,
  1007431740,
  826372464,
  285282576,
  130532292,
  160006536,
  893743476,
  1003222008,
  449499864,
  952692984,
  344232084,
  424235352,
  42107520,
  80003268,
  1070593020,
  155795784,
  956903736,
  658989924,
  12632256,
  265274316,
  398971860,
  948482232,
  252642060,
  244220556,
  37896768,
  587408160,
  293704080,
  743202924,
  466342872,
  612671652,
  872689716,
  834793968,
  138952776,
  46318272,
  793731948,
  1024274748,
  755835180,
  4210752,
  1049539260,
  1041117756,
  1015853244,
  29475264,
  713728680,
  982168248,
  240009804,
  356864340,
  990589752,
  483184860,
  675831912,
  1062171516,
  478974108,
  415813848,
  172638792,
  373707348,
  927429492,
  545300640,
  768467436,
  105267780,
  897954228,
  722150184,
  625303908,
  986379000,
  600040416,
  965325240,
  830583216,
  529503132,
  508449372,
  969535992,
  650568420,
  847426224,
  822161712,
  717939432,
  760045932,
  525292380,
  616882404,
  817950960,
  231588300,
  143163528,
  369496596,
  973746744,
  407392344,
  348442836,
  574775904,
  688464168,
  117900036,
  855847728,
  684253416,
  453710616,
  84214020,
  961114488,
  276861072,
  709517928,
  705307176,
  445289112
}; // idb
int SS1[256] =
{
  943196208,
  -399980320,
  741149985,
  -1540979038,
  -871379005,
  -601960750,
  -1338801229,
  -1204254544,
  -1406169181,
  1612726368,
  1410680145,
  -1006123069,
  1141130304,
  1815039843,
  1747667811,
  1478183763,
  -1073495101,
  1612857954,
  808649523,
  -1271560783,
  673777953,
  -1608482656,
  -534592798,
  -1540913245,
  -804011053,
  -1877900911,
  269549841,
  67503618,
  471600144,
  -1136882512,
  875955762,
  1208699715,
  -332410909,
  -2012706688,
  1814842464,
  -1473738592,
  337053459,
  -1006320448,
  336987666,
  -197868304,
  -1073560894,
  1141196097,
  -534658591,
  -736704814,
  1010765619,
  1010634033,
  -1945203070,
  -1743222640,
  673712160,
  1276005954,
  -197736718,
  1010699826,
  -1541044831,
  -130430479,
  202181889,
  -601894957,
  -669464368,
  673909539,
  1680229986,
  2017086066,
  606537507,
  741281571,
  -265174543,
  1882342002,
  1073889858,
  -736836400,
  1073824065,
  -1073692480,
  1882407795,
  1680295779,
  -1406366560,
  -2012509309,
  -197670925,
  -1406300767,
  -2147450752,
  471797523,
  -938816830,
  741084192,
  -1473607006,
  875824176,
  -804076846,
  134941443,
  -332476702,
  -399914527,
  1545424209,
  -1810594672,
  404228112,
  -130496272,
  1410811731,
  -1406234974,
  134744064,
  -1006254655,
  269681427,
  -871510591,
  -2079947134,
  -1204188751,
  -62926861,
  2084392305,
  -1073626687,
  808517937,
  -197802511,
  -2012575102,
  1747602018,
  -1338932815,
  -804142639,
  538968096,
  -736639021,
  131586,
  539099682,
  67372032,
  1747470432,
  1882276209,
  67569411,
  -669266989,
  -1675784815,
  -1743156847,
  1612792161,
  -1136750926,
  -467220766,
  1478052177,
  -602026543,
  1343308113,
  -1877966704,
  -602092336,
  -1743091054,
  -1608285277,
  -1473541213,
  -804208432,
  -2147384959,
  202313475,
  1141327683,
  404359698,
  -534527005,
  -332608288,
  -1945268863,
  -1136685133,
  -1810463086,
  2017151859,
  1545358416,
  -1608351070,
  -1608416863,
  1612923747,
  539165475,
  1275940161,
  -938948416,
  -1675719022,
  -1675850608,
  943327794,
  202116096,
  741215778,
  -1204122958,
  1814974050,
  -1675653229,
  1478117970,
  -265108750,
  -1877835118,
  -265042957,
  1208568129,
  2016954480,
  -871576384,
  336921873,
  -130298893,
  1882210416,
  1949648241,
  2084523891,
  875889969,
  269484048,
  197379,
  1680098400,
  1814908257,
  -1006188862,
  1949582448,
  -736770607,
  -1271626576,
  -399848734,
  134809857,
  1949714034,
  404293905,
  -62992654,
  1073758272,
  269615634,
  -534724384,
  -1136816719,
  67437825,
  -130364686,
  65793,
  -265240336,
  673843746,
  1545490002,
  -1473672799,
  1410745938,
  1073955651,
  -2080012927,
  336856080,
  -2012640895,
  -1743025261,
  -1338998608,
  -467286559,
  1208502336,
  2017020273,
  -1810397293,
  -63124240,
  471731730,
  -2147319166,
  539033889,
  -1945334656,
  404425491,
  1545555795,
  1949779827,
  1410614352,
  -1338867022,
  471665937,
  606405921,
  1276071747,
  0,
  1141261890,
  -332542495,
  1477986384,
  1343373906,
  -399782941,
  2084458098,
  -669332782,
  -938882623,
  -63058447,
  808452144,
  -1810528879,
  1680164193,
  1010568240,
  -1271494990,
  -467352352,
  -1204057165,
  2084326512,
  202247682,
  1343242320,
  943262001,
  606471714,
  808583730,
  -2080078720,
  1747536225,
  -1877769325,
  876021555,
  -467154973,
  606340128,
  -1541110624,
  -938751037,
  1343439699,
  134875650,
  -2079881341,
  -669398575,
  1275874368,
  -2147253373,
  -1945137277,
  -871444798,
  943393587,
  1208633922,
  -1271429197
}; // idb
int SS2[256] =
{
  -1582814839,
  -2122054267,
  -757852474,
  -741338173,
  1347687492,
  287055117,
  -1599329140,
  556016901,
  1364991309,
  1128268611,
  270014472,
  303832590,
  1364201793,
  -251904820,
  -1027077430,
  1667244867,
  539502600,
  1078199364,
  538976256,
  -1852039795,
  -522182464,
  -488627518,
  -1060632376,
  320083719,
  -1583078011,
  -2087972977,
  50332419,
  1937259339,
  -1279771765,
  319820547,
  -758115646,
  -487838002,
  1886400576,
  -2138305396,
  859586319,
  -1599592312,
  842019330,
  -774103603,
  -218876218,
  1886663748,
  -521392948,
  -1852566139,
  50858763,
  1398019911,
  1348213836,
  1398283083,
  -1313063539,
  16777473,
  539239428,
  270277644,
  1936732995,
  -1869080440,
  269488128,
  -1060369204,
  -219139390,
  -774366775,
  539765772,
  -471586873,
  1919955522,
  -2088762493,
  -1818748021,
  -774893119,
  -2105276794,
  -1043854903,
  1616912448,
  1347424320,
  -1549786237,
  -471323701,
  17566989,
  -1296812410,
  -1835262322,
  1129058127,
  -1280034937,
  1381505610,
  -1027340602,
  1886926920,
  -1566300538,
  303043074,
  -1548996721,
  -774629947,
  1633689921,
  -1010826301,
  -1330367356,
  1094713665,
  1380979266,
  1903967565,
  -2121527923,
  526344,
  320610063,
  -1852302967,
  0,
  286791945,
  263172,
  1397756739,
  -202098745,
  -505404991,
  -235127347,
  1920218694,
  590098191,
  589571847,
  -1330630528,
  -2088236149,
  34344462,
  -1549259893,
  -1566563710,
  1651256910,
  -1819274365,
  1095503181,
  1634216265,
  1887190092,
  17303817,
  34081290,
  -1279508593,
  -471060529,
  -202361917,
  -1044118075,
  -2088499321,
  269751300,
  -218349874,
  1617175620,
  -757326130,
  573320718,
  1128794955,
  303569418,
  33818118,
  555753729,
  1667771211,
  1650730566,
  33554946,
  -235653691,
  -1836051838,
  -2105013622,
  789516,
  -1280298109,
  1920745038,
  -791670592,
  1920481866,
  1128531783,
  -1835788666,
  -505141819,
  572794374,
  -2139094912,
  -1582551667,
  -740548657,
  -1583341183,
  808464384,
  859059975,
  -1565774194,
  842282502,
  286528773,
  572531202,
  808990728,
  -252431164,
  -1549523065,
  1094976837,
  1078725708,
  -2122317439,
  -504878647,
  -2138831740,
  -1819011193,
  825505029,
  -1010299957,
  -1026814258,
  809253900,
  1903178049,
  286265601,
  -1010563129,
  -2121791095,
  1903441221,
  -201835573,
  -757589302,
  -252167992,
  -1869343612,
  1364728137,
  -2105539966,
  -1060895548,
  -201572401,
  1095240009,
  825768201,
  1667508039,
  -1061158720,
  -1010036785,
  -741075001,
  -1330104184,
  51121935,
  -2104750450,
  1111491138,
  589308675,
  -1852829311,
  1617701964,
  -740811829,
  -1599855484,
  808727556,
  -235916863,
  1078462536,
  -1027603774,
  1668034383,
  826031373,
  556543245,
  1077936192,
  -1296286066,
  842808846,
  -1329841012,
  -1044381247,
  -1566037366,
  -1296549238,
  1112280654,
  1364464965,
  859323147,
  -790881076,
  1617438792,
  1937522511,
  -1868817268,
  -791144248,
  1112017482,
  1381242438,
  1936996167,
  -1600118656,
  -504615475,
  1111754310,
  -1313589883,
  589835019,
  1633953093,
  -218613046,
  -471850045,
  -1313326711,
  -1313853055,
  -1818484849,
  1381768782,
  -235390519,
  -488364346,
  -1297075582,
  825241857,
  -488101174,
  1634479437,
  1398546255,
  -521919292,
  -252694336,
  -1043591731,
  -2138568568,
  303306246,
  842545674,
  1347950664,
  -791407420,
  1650467394,
  556280073,
  50595591,
  858796803,
  -521656120,
  320346891,
  17040645,
  1903704393,
  -1869606784,
  1650993738,
  573057546,
  -1835525494
}; // idb
int SS3[256] =
{
  137377848,
  -924784600,
  220277805,
  -2036161498,
  -809251825,
  -825041890,
  -2085375949,
  -2001684424,
  -1885098961,
  1080057888,
  1162957845,
  -943471609,
  1145062404,
  1331915823,
  1264805931,
  1263753243,
  -1010581501,
  1113743394,
  53686323,
  -2051951563,
  153167913,
  -2136956896,
  -1025318878,
  -2019318745,
  -1009528813,
  -2121166831,
  17895441,
  100795398,
  202382364,
  -1934574532,
  103953462,
  1262700555,
  -807146449,
  -2004842488,
  1281387564,
  -2002737112,
  118690839,
  -993999868,
  101848086,
  -990841804,
  -1027424254,
  1161905157,
  -1042161631,
  -959261674,
  255015999,
  221330493,
  -1904047090,
  -2003789800,
  136325160,
  1312967694,
  -957156298,
  238173246,
  -2053004251,
  -906889159,
  218172429,
  -808199137,
  -925837288,
  186853419,
  1180853286,
  1249015866,
  119743527,
  253963311,
  -1041108943,
  1114796082,
  1111638018,
  -992947180,
  1094795265,
  -1061109760,
  1131638835,
  1197696039,
  -1935627220,
  -1954314229,
  -940313545,
  -1918784467,
  -2139062272,
  252910623,
  -893204470,
  203435052,
  -1969051606,
  70267956,
  -1026371566,
  184748043,
  -823989202,
  -907941847,
  1297177629,
  -2070899692,
  135272472,
  -923731912,
  1196643351,
  -1901941714,
  134219784,
  -977157115,
  51580947,
  -842937331,
  -2038266874,
  -1984841671,
  -806093761,
  1299283005,
  -1044267007,
  20000817,
  -973999051,
  -1971156982,
  1247963178,
  -2119061455,
  -1043214319,
  2105376,
  -942418921,
  33685506,
  35790882,
  67109892,
  1214277672,
  1097953329,
  117638151,
  -875309029,
  -1919837155,
  -1986947047,
  1096900641,
  -1900889026,
  -958208986,
  1230067737,
  -841884643,
  1095847953,
  -2138009584,
  -858727396,
  -1970104294,
  -2086428637,
  -1952208853,
  -1060057072,
  -2122219519,
  251857935,
  1195590663,
  168957978,
  -1008476125,
  -857674708,
  -1920889843,
  -1884046273,
  -2037214186,
  1265858619,
  1280334876,
  -2103271390,
  -2120114143,
  1130586147,
  52633635,
  1296124941,
  -926889976,
  -1902994402,
  -1936679908,
  171063354,
  201329676,
  237120558,
  -1967998918,
  1315073070,
  -1886151649,
  1246910490,
  -1024266190,
  -2104324078,
  -1007423437,
  1229015049,
  1215330360,
  -859780084,
  85005333,
  -873203653,
  1081110576,
  1165063221,
  1332968511,
  87110709,
  1052688,
  50528259,
  1147167780,
  1298230317,
  -960314362,
  1148220468,
  -976104427,
  -2068794316,
  -891099094,
  151062537,
  1181905974,
  152115225,
  -822936514,
  1077952512,
  34738194,
  -1059004384,
  -1917731779,
  83952645,
  -890046406,
  16842753,
  -1057951696,
  170010666,
  1314020382,
  -1985894359,
  1179800598,
  1128480771,
  -2055109627,
  68162580,
  -1987999735,
  -1953261541,
  -2135904208,
  -975051739,
  1212172296,
  1232173113,
  -2020371433,
  -856622020,
  236067870,
  -2105376766,
  18948129,
  -1937732596,
  185800731,
  1330863135,
  1198748727,
  1146115092,
  -2102218702,
  219225117,
  86058021,
  1329810447,
  0,
  1178747910,
  -840831955,
  1213224984,
  1112690706,
  -874256341,
  1316125758,
  -892151782,
  -910047223,
  -839779267,
  3158064,
  -2054056939,
  1164010533,
  204487740,
  -2035108810,
  -991894492,
  -1951156165,
  1282440252,
  235015182,
  1079005200,
  154220601,
  102900774,
  36843570,
  -2071952380,
  1231120425,
  -2087481325,
  120796215,
  -941366233,
  69215268,
  -2069847004,
  -876361717,
  1129533459,
  167905290,
  -2021424121,
  -908994535,
  1279282188,
  -2088534013,
  -1887204337,
  -826094578,
  187906107,
  1245857802,
  -2018266057
}; // idb
__int16 clientKeyId = 86; // weak
__int16 serverKeyId = 61; // weak
char `string'[17] =
{
  '\xEB',
  '\xB6',
  '\xDC',
  '\x11',
  '\xAA',
  '\xD8',
  '0',
  '|',
  '/',
  '\xE6',
  '\xBD',
  '\xC7',
  'X',
  '\xFC',
  'n',
  ']',
  '\0'
}; // idb
const char `string'[] = "\x1B"; // idb
char `string'[17] =
{
  '\xA3',
  '\xFE',
  '\x91',
  '\x8F',
  '\xEB',
  '\xE1',
  '\xDC',
  '\\',
  'A',
  '\xE0',
  ' ',
  '@',
  '\xAE',
  '\xA6',
  '\xAB',
  '\xA7',
  '\0'
}; // idb


//----- (00001510) --------------------------------------------------------
int _E4()
{
  _E1();
  return _E3();
}

//----- (00001520) --------------------------------------------------------
CFvCrc32 *_E1()
{
  return CFvCrc32::CFvCrc32((CFvCrc32 *)&crc);
}

//----- (00001530) --------------------------------------------------------
int _E3()
{
  return atexit(_E2);
}

//----- (00001540) --------------------------------------------------------
void __cdecl _E2()
{
  CFvCrc32::~CFvCrc32((CFvCrc32 *)&crc);
}

//----- (00001550) --------------------------------------------------------
int __cdecl InitPacketProtect(char *a1)
{
  char v1; // cl
  int i; // eax
  char v3; // cl
  int j; // eax
  unsigned int v5; // eax
  char v7[20]; // [esp+Ch] [ebp-14h] BYREF

  strcpy(v7, `string');
  if ( a1 )
  {
    v1 = *a1;
    for ( i = 0; v1; ++i )
    {
      v7[i % 16] ^= v1;
      v1 = a1[i + 1];
    }
  }
  SeedEncRoundKey(clientRoundKey, (unsigned __int8 *)v7);
  strcpy(v7, `string');
  if ( a1 )
  {
    v3 = *a1;
    for ( j = 0; v3; ++j )
    {
      v7[j % 16] ^= v3;
      v3 = a1[j + 1];
    }
  }
  SeedEncRoundKey(serverRoundKey, (unsigned __int8 *)v7);
  strcpy(v7, `string');
  v5 = _time(0);
  _srand(v5);
  return 1;
}

//----- (000016AC) --------------------------------------------------------
int *__cdecl SeedEncRoundKey(int *a1, unsigned __int8 *a2)
{
  unsigned __int16 v2; // cx
  unsigned int v3; // esi
  unsigned int v4; // edi
  unsigned __int16 v5; // dx
  unsigned int v6; // ecx
  unsigned int v7; // ebp
  int *result; // eax
  unsigned int v9; // edx
  unsigned int v10; // esi
  unsigned int v11; // edi
  unsigned int v12; // ecx
  unsigned int v13; // edx
  unsigned int v14; // edi
  unsigned int v15; // esi
  unsigned int v16; // ecx
  unsigned int v17; // edi
  unsigned int v18; // edx
  unsigned int v19; // esi
  unsigned int v20; // edi
  unsigned int v21; // ecx
  unsigned int v22; // edx
  unsigned int v23; // edi
  unsigned int v24; // esi
  unsigned int v25; // ecx
  unsigned int v26; // edi
  unsigned int v27; // edx
  int v28; // ebx
  unsigned int v29; // esi
  unsigned int v30; // edx
  unsigned int v31; // [esp+18h] [ebp+4h]
  unsigned int v32; // [esp+18h] [ebp+4h]
  unsigned int v33; // [esp+18h] [ebp+4h]
  unsigned int v34; // [esp+18h] [ebp+4h]
  unsigned int v35; // [esp+18h] [ebp+4h]
  unsigned int v36; // [esp+18h] [ebp+4h]
  unsigned int v37; // [esp+18h] [ebp+4h]
  int v38; // [esp+1Ch] [ebp+8h]

  LOBYTE(v2) = 0;
  HIBYTE(v2) = a2[2];
  v3 = a2[3] | v2 | (a2[1] << 16) | (*a2 << 24);
  LOBYTE(v2) = 0;
  HIBYTE(v2) = a2[6];
  v4 = a2[7] | v2 | (a2[5] << 16) | (a2[4] << 24);
  LOBYTE(v5) = 0;
  HIBYTE(v5) = a2[10];
  v6 = a2[11] | v5 | (a2[9] << 16) | (a2[8] << 24);
  HIBYTE(v5) = a2[14];
  LOBYTE(v5) = a2[15];
  v7 = v5 | (a2[13] << 16) | (a2[12] << 24);
  result = a1;
  *a1 = SS0[(unsigned __int8)(v6 + v3 + 71)] ^ SS1[(unsigned __int8)((unsigned __int16)(v6 + v3 - 31161) >> 8)] ^ SS2[(unsigned __int8)((v6 + v3 + 1640531527) >> 16)] ^ SS3[(v6 + v3 + 1640531527) >> 24];
  a1[1] = SS0[(unsigned __int8)(v4 - v7 - 71)] ^ SS1[(unsigned __int8)((unsigned __int16)(v4 - v7 + 31161) >> 8)] ^ SS2[(unsigned __int8)((v4 - v7 - 1640531527) >> 16)] ^ SS3[(v4 - v7 - 1640531527) >> 24];
  v9 = (v3 >> 8) ^ (v4 << 24);
  v31 = (v4 >> 8) ^ (v3 << 24);
  result[2] = SS0[(unsigned __int8)(v6 + v9 - 115)] ^ SS1[(unsigned __int8)((unsigned __int16)(v6 + v9 + 3213) >> 8)] ^ SS2[(unsigned __int8)((v6 + v9 - 1013904243) >> 16)] ^ SS3[(v6 + v9 - 1013904243) >> 24];
  result[3] = SS0[(unsigned __int8)(v31 - v7 + 115)] ^ SS1[(unsigned __int8)((unsigned __int16)(v31 - v7 - 3213) >> 8)] ^ SS2[(unsigned __int8)((v31 - v7 + 1013904243) >> 16)] ^ SS3[(v31 - v7 + 1013904243) >> 24];
  v10 = (v6 << 8) ^ HIBYTE(v7);
  v11 = (v7 << 8) ^ HIBYTE(v6);
  result[4] = SS0[(unsigned __int8)(v10 + v9 + 26)] ^ SS1[(unsigned __int8)((unsigned __int16)(v10 + v9 + 6426) >> 8)] ^ SS2[(unsigned __int8)((v10 + v9 - 2027808486) >> 16)] ^ SS3[(v10 + v9 - 2027808486) >> 24];
  result[5] = SS0[(unsigned __int8)(v31 - v11 - 26)] ^ SS1[(unsigned __int8)((unsigned __int16)(v31 - v11 - 6426) >> 8)] ^ SS2[(unsigned __int8)((v31 - v11 + 2027808486) >> 16)] ^ SS3[(v31 - v11 + 2027808486) >> 24];
  v12 = (v9 >> 8) ^ (v31 << 24);
  v32 = (v31 >> 8) ^ (v9 << 24);
  result[6] = SS0[(unsigned __int8)(v10 + v12 + 52)] ^ SS1[(unsigned __int8)((unsigned __int16)(v10 + v12 + 12852) >> 8)] ^ SS2[(unsigned __int8)((v10 + v12 + 239350324) >> 16)] ^ SS3[(v10 + v12 + 239350324) >> 24];
  result[7] = SS0[(unsigned __int8)(v32 - v11 - 52)] ^ SS1[(unsigned __int8)((unsigned __int16)(v32 - v11 - 12852) >> 8)] ^ SS2[(unsigned __int8)((v32 - v11 - 239350324) >> 16)] ^ SS3[(v32 - v11 - 239350324) >> 24];
  v13 = (v10 << 8) ^ HIBYTE(v11);
  v14 = (v11 << 8) ^ HIBYTE(v10);
  result[8] = SS0[(unsigned __int8)(v13 + v12 + 103)] ^ SS1[(unsigned __int8)((unsigned __int16)(v13 + v12 + 25703) >> 8)] ^ SS2[(unsigned __int8)((v13 + v12 + 478700647) >> 16)] ^ SS3[(v13 + v12 + 478700647) >> 24];
  result[9] = SS0[(unsigned __int8)(v32 - v14 - 103)] ^ SS1[(unsigned __int8)((unsigned __int16)(v32 - v14 - 25703) >> 8)] ^ SS2[(unsigned __int8)((v32 - v14 - 478700647) >> 16)] ^ SS3[(v32 - v14 - 478700647) >> 24];
  v15 = (v12 >> 8) ^ (v32 << 24);
  v33 = (v32 >> 8) ^ (v12 << 24);
  result[10] = SS0[(unsigned __int8)(v13 + v15 - 51)] ^ SS1[(unsigned __int8)((unsigned __int16)(v13 + v15 - 14131) >> 8)] ^ SS2[(unsigned __int8)((v13 + v15 + 957401293) >> 16)] ^ SS3[(v13 + v15 + 957401293) >> 24];
  result[11] = SS0[(unsigned __int8)(v33 - v14 + 51)] ^ SS1[(unsigned __int8)((unsigned __int16)(v33 - v14 + 14131) >> 8)] ^ SS2[(unsigned __int8)((v33 - v14 - 957401293) >> 16)] ^ SS3[(v33 - v14 - 957401293) >> 24];
  v16 = (v13 << 8) ^ HIBYTE(v14);
  v17 = (v14 << 8) ^ HIBYTE(v13);
  result[12] = SS0[(unsigned __int8)(v16 + v15 - 103)] ^ SS1[(unsigned __int8)((unsigned __int16)(v16 + v15 - 28263) >> 8)] ^ SS2[(unsigned __int8)((v16 + v15 + 1914802585) >> 16)] ^ SS3[(v16 + v15 + 1914802585) >> 24];
  result[13] = SS0[(unsigned __int8)(v33 - v17 + 103)] ^ SS1[(unsigned __int8)((unsigned __int16)(v33 - v17 + 28263) >> 8)] ^ SS2[(unsigned __int8)((v33 - v17 - 1914802585) >> 16)] ^ SS3[(v33 - v17 - 1914802585) >> 24];
  v18 = (v15 >> 8) ^ (v33 << 24);
  v34 = (v33 >> 8) ^ (v15 << 24);
  result[14] = SS0[(unsigned __int8)(v16 + v18 + 49)] ^ SS1[(unsigned __int8)((unsigned __int16)(v16 + v18 + 9009) >> 8)] ^ SS2[(unsigned __int8)((v16 + v18 - 465362127) >> 16)] ^ SS3[(v16 + v18 - 465362127) >> 24];
  result[15] = SS0[(unsigned __int8)(v34 - v17 - 49)] ^ SS1[(unsigned __int8)((unsigned __int16)(v34 - v17 - 9009) >> 8)] ^ SS2[(unsigned __int8)((v34 - v17 + 465362127) >> 16)] ^ SS3[(v34 - v17 + 465362127) >> 24];
  v19 = (v16 << 8) ^ HIBYTE(v17);
  v20 = (v17 << 8) ^ HIBYTE(v16);
  result[16] = SS0[(unsigned __int8)(v19 + v18 + 98)] ^ SS1[(unsigned __int8)((unsigned __int16)(v19 + v18 + 18018) >> 8)] ^ SS2[(unsigned __int8)((v19 + v18 - 930724254) >> 16)] ^ SS3[(v19 + v18 - 930724254) >> 24];
  result[17] = SS0[(unsigned __int8)(v34 - v20 - 98)] ^ SS1[(unsigned __int8)((unsigned __int16)(v34 - v20 - 18018) >> 8)] ^ SS2[(unsigned __int8)((v34 - v20 + 930724254) >> 16)] ^ SS3[(v34 - v20 + 930724254) >> 24];
  v21 = (v18 >> 8) ^ (v34 << 24);
  v35 = (v34 >> 8) ^ (v18 << 24);
  result[18] = SS0[(unsigned __int8)(v19 + v21 - 60)] ^ SS1[(unsigned __int8)((unsigned __int16)(v19 + v21 - 29500) >> 8)] ^ SS2[(unsigned __int8)((v19 + v21 - 1861448508) >> 16)] ^ SS3[(v19 + v21 - 1861448508) >> 24];
  result[19] = SS0[(unsigned __int8)(v35 - v20 + 60)] ^ SS1[(unsigned __int8)((unsigned __int16)(v35 - v20 + 29500) >> 8)] ^ SS2[(unsigned __int8)((v35 - v20 + 1861448508) >> 16)] ^ SS3[(v35 - v20 + 1861448508) >> 24];
  v22 = (v19 << 8) ^ HIBYTE(v20);
  v23 = (v20 << 8) ^ HIBYTE(v19);
  result[20] = SS0[(unsigned __int8)(v22 + v21 - 120)] ^ SS1[(unsigned __int8)((unsigned __int16)(v22 + v21 + 6536) >> 8)] ^ SS2[(unsigned __int8)((v22 + v21 + 572070280) >> 16)] ^ SS3[(v22 + v21 + 572070280) >> 24];
  result[21] = SS0[(unsigned __int8)(v35 - v23 + 120)] ^ SS1[(unsigned __int8)((unsigned __int16)(v35 - v23 - 6536) >> 8)] ^ SS2[(unsigned __int8)((v35 - v23 - 572070280) >> 16)] ^ SS3[(v35 - v23 - 572070280) >> 24];
  v24 = (v21 >> 8) ^ (v35 << 24);
  v36 = (v35 >> 8) ^ (v21 << 24);
  result[22] = SS0[(unsigned __int8)(v22 + v24 + 15)] ^ SS1[(unsigned __int8)((unsigned __int16)(v22 + v24 + 13071) >> 8)] ^ SS2[(unsigned __int8)((v22 + v24 + 1144140559) >> 16)] ^ SS3[(v22 + v24 + 1144140559) >> 24];
  result[23] = SS0[(unsigned __int8)(v36 - v23 - 15)] ^ SS1[(unsigned __int8)((unsigned __int16)(v36 - v23 - 13071) >> 8)] ^ SS2[(unsigned __int8)((v36 - v23 - 1144140559) >> 16)] ^ SS3[(v36 - v23 - 1144140559) >> 24];
  v25 = (v22 << 8) ^ HIBYTE(v23);
  v26 = (v23 << 8) ^ HIBYTE(v22);
  result[24] = SS0[(unsigned __int8)(v25 + v24 + 29)] ^ SS1[(unsigned __int8)((unsigned __int16)(v25 + v24 + 26141) >> 8)] ^ SS2[(unsigned __int8)((v25 + v24 - 2006686179) >> 16)] ^ SS3[(v25 + v24 - 2006686179) >> 24];
  result[25] = SS0[(unsigned __int8)(v36 - v26 - 29)] ^ SS1[(unsigned __int8)((unsigned __int16)(v36 - v26 - 26141) >> 8)] ^ SS2[(unsigned __int8)((v36 - v26 + 2006686179) >> 16)] ^ SS3[(v36 - v26 + 2006686179) >> 24];
  v27 = (v24 >> 8) ^ (v36 << 24);
  v37 = (v36 >> 8) ^ (v24 << 24);
  result[26] = SS0[(unsigned __int8)(v25 + v27 + 58)] ^ SS1[(unsigned __int8)((unsigned __int16)(v25 + v27 - 13254) >> 8)] ^ SS2[(unsigned __int8)((v25 + v27 + 281594938) >> 16)] ^ SS3[(v25 + v27 + 281594938) >> 24];
  result[27] = SS0[(unsigned __int8)(v37 - v26 - 58)] ^ SS1[(unsigned __int8)((unsigned __int16)(v37 - v26 + 13254) >> 8)] ^ SS2[(unsigned __int8)((v37 - v26 - 281594938) >> 16)] ^ SS3[(v37 - v26 - 281594938) >> 24];
  v28 = (v26 << 8) ^ HIBYTE(v25);
  v38 = (v25 << 8) ^ HIBYTE(v26);
  result[28] = SS0[(unsigned __int8)(v38 + v27 + 115)] ^ SS1[(unsigned __int8)((unsigned __int16)(v38 + v27 - 26509) >> 8)] ^ SS2[(unsigned __int8)((v38 + v27 + 563189875) >> 16)] ^ SS3[(v38 + v27 + 563189875) >> 24];
  result[29] = SS0[(unsigned __int8)(v37 - v28 - 115)] ^ SS1[(unsigned __int8)((unsigned __int16)(v37 - v28 + 26509) >> 8)] ^ SS2[(unsigned __int8)((v37 - v28 - 563189875) >> 16)] ^ SS3[(v37 - v28 - 563189875) >> 24];
  v29 = v38 + ((v27 >> 8) ^ (v37 << 24)) + 1126379749;
  v30 = ((v37 >> 8) ^ (v27 << 24)) - v28 - 1126379749;
  result[30] = SS0[(unsigned __int8)v29] ^ SS1[BYTE1(v29)] ^ SS2[BYTE2(v29)] ^ SS3[HIBYTE(v29)];
  result[31] = SS0[(unsigned __int8)v30] ^ SS1[BYTE1(v30)] ^ SS2[BYTE2(v30)] ^ SS3[HIBYTE(v30)];
  return result;
}

//----- (0000229C) --------------------------------------------------------
unsigned int __cdecl PPEncryptClientPacket(unsigned __int8 *a1, unsigned int a2, int a3)
{
  unsigned int v3; // ebx
  unsigned int v4; // eax
  unsigned int v5; // edi
  unsigned int v6; // ebp
  unsigned __int8 *v7; // esi
  int *v8; // edi
  unsigned int v9; // eax
  int v10; // esi
  unsigned __int8 v11; // eax^3
  unsigned __int8 *v12; // esi
  __int16 v13; // ax
  unsigned __int8 v14; // ecx^2
  unsigned int v15; // ebx

  v3 = a2;
  v4 = a2 & 0xF;
  v5 = 0;
  v6 = 16 - v4;
  dwPPLastError = 0;
  if ( v4 != 16 )
  {
    v7 = &a1[a2];
    do
      v7[v5++] = _rand();
    while ( v5 < v6 );
  }
  v8 = (int *)a3;
  if ( !*(_DWORD *)a3 )
  {
    v9 = _time(0);
    _srand(v9);
    *v8 = _rand();
  }
  v10 = *v8 + 1;
  a2 = 0;
  *v8 = v10;
  v11 = HIBYTE(v10);
  v12 = &a1[v6 + v3];
  *v12++ = v11;
  *v12++ = BYTE2(*v8);
  *v12++ = BYTE1(*v8);
  *v12++ = *(_BYTE *)v8;
  CFvCrc32::Crc32Mem((CFvCrc32 *)&crc, a1, v3 + v6 + 4, &a2);
  v13 = a2;
  v14 = BYTE2(a2);
  *v12++ = HIBYTE(a2);
  *v12++ = v14;
  *v12++ = HIBYTE(v13);
  *v12++ = v13;
  *v12++ = HIBYTE(v3);
  *v12++ = BYTE2(v3);
  *v12++ = BYTE1(v3);
  *v12++ = v3;
  v15 = v3 + v6 + 16;
  *v12++ = 0;
  *v12++ = 0;
  *v12 = HIBYTE(clientKeyId);
  v12[1] = clientKeyId;
  SeedEncrypt(a1, v15, (int)clientRoundKey);
  return v15;
}
// 504: using guessed type int dwPPLastError;
// 1508: using guessed type __int16 clientKeyId;

//----- (000023CC) --------------------------------------------------------
int __cdecl SeedEncrypt(unsigned __int8 *a1, unsigned int a2, int a3)
{
  int v3; // esi
  int v4; // ebx
  unsigned __int8 *v5; // ebp
  unsigned int v6; // edi
  unsigned __int8 *v7; // edi
  unsigned int v8; // ecx
  char *v9; // edi
  int v10; // ecx

  v3 = a2;
  v4 = 0;
  if ( (int)a2 >= 16 )
  {
    v5 = a1;
    v6 = a2 >> 4;
    v3 = a2 - 16 * (a2 >> 4);
    v4 = 16 * (a2 >> 4);
    do
    {
      SeedEncryptBlock(v5, a3);
      v5 += 16;
      --v6;
    }
    while ( v6 );
  }
  if ( !v3 )
    return v4;
  if ( v3 < 16 )
  {
    v7 = &a1[v4 + v3];
    v8 = (unsigned int)(16 - v3) >> 2;
    memset(v7, 0, 4 * v8);
    v9 = (char *)&v7[4 * v8];
    v10 = (16 - (_BYTE)v3) & 3;
    v3 = 16;
    memset(v9, 0, v10);
  }
  SeedEncryptBlock(&a1[v4], a3);
  return v3 + v4;
}

//----- (0000245C) --------------------------------------------------------
unsigned __int8 *__cdecl SeedEncryptBlock(unsigned __int8 *a1, int a2)
{
  unsigned __int16 v2; // dx
  int v3; // ecx
  unsigned __int16 v4; // bx
  int v5; // edx
  int v6; // edi
  int v7; // esi
  int v8; // ebx
  int v9; // edi
  int v10; // ecx
  int v11; // edi
  unsigned int v12; // ebx
  int v13; // edi
  int v14; // esi
  int v15; // ebx
  int v16; // edi
  int v17; // edx
  int v18; // edi
  unsigned int v19; // ebx
  int v20; // edi
  int v21; // esi
  int v22; // ebx
  int v23; // edi
  int v24; // ecx
  int v25; // edi
  unsigned int v26; // ebx
  int v27; // edi
  int v28; // esi
  int v29; // ebx
  int v30; // edi
  int v31; // edx
  int v32; // edi
  unsigned int v33; // ebx
  int v34; // edi
  int v35; // esi
  int v36; // ebx
  int v37; // edi
  int v38; // ecx
  int v39; // edi
  unsigned int v40; // ebx
  int v41; // edi
  int v42; // esi
  int v43; // ebx
  int v44; // edi
  int v45; // edx
  int v46; // edi
  unsigned int v47; // ebx
  int v48; // edi
  int v49; // esi
  int v50; // ebx
  int v51; // edi
  int v52; // ecx
  int v53; // edi
  unsigned int v54; // ebx
  int v55; // edi
  int v56; // esi
  int v57; // ebx
  int v58; // edi
  int v59; // edx
  int v60; // edi
  unsigned int v61; // ebx
  int v62; // edi
  int v63; // esi
  int v64; // ebx
  int v65; // edi
  int v66; // ecx
  int v67; // edi
  unsigned int v68; // ebx
  int v69; // edi
  int v70; // esi
  int v71; // ebx
  int v72; // edi
  int v73; // edx
  int v74; // edi
  unsigned int v75; // ebx
  int v76; // edi
  int v77; // esi
  int v78; // ebx
  int v79; // edi
  int v80; // ecx
  int v81; // edi
  unsigned int v82; // ebx
  int v83; // edi
  int v84; // esi
  int v85; // ebx
  int v86; // edi
  int v87; // edx
  int v88; // edi
  unsigned int v89; // ebx
  int v90; // edi
  int v91; // esi
  int v92; // ebx
  int v93; // edi
  int v94; // ecx
  int v95; // edi
  unsigned int v96; // ebx
  int v97; // edi
  int v98; // esi
  int v99; // ebx
  int v100; // edi
  int v101; // edx
  int v102; // edi
  unsigned int v103; // ebx
  int v104; // edi
  int v105; // esi
  int v106; // ebx
  int v107; // edi
  int v108; // ecx
  unsigned int v109; // eax
  int v110; // edi
  int v111; // esi
  int v112; // eax
  int v113; // edi
  int v114; // edx
  unsigned __int8 *result; // eax
  int v116; // [esp+10h] [ebp-Ch]
  int v117; // [esp+10h] [ebp-Ch]
  int v118; // [esp+10h] [ebp-Ch]
  int v119; // [esp+10h] [ebp-Ch]
  int v120; // [esp+10h] [ebp-Ch]
  int v121; // [esp+10h] [ebp-Ch]
  int v122; // [esp+10h] [ebp-Ch]
  int v123; // [esp+10h] [ebp-Ch]
  int v124; // [esp+10h] [ebp-Ch]
  int v125; // [esp+14h] [ebp-8h]
  int v126; // [esp+14h] [ebp-8h]
  int v127; // [esp+14h] [ebp-8h]
  int v128; // [esp+14h] [ebp-8h]
  int v129; // [esp+14h] [ebp-8h]
  int v130; // [esp+14h] [ebp-8h]
  int v131; // [esp+14h] [ebp-8h]
  int v132; // [esp+14h] [ebp-8h]
  int v133; // [esp+14h] [ebp-8h]

  LOBYTE(v2) = 0;
  HIBYTE(v2) = a1[2];
  v3 = a1[3] | v2 | (a1[1] << 16) | (*a1 << 24);
  LOBYTE(v2) = 0;
  HIBYTE(v2) = a1[6];
  v125 = a1[7] | v2 | (a1[5] << 16) | (a1[4] << 24);
  LOBYTE(v4) = 0;
  HIBYTE(v4) = a1[10];
  v5 = a1[11] | v4 | (a1[9] << 16) | (a1[8] << 24);
  v116 = (a1[13] << 16) | (a1[12] << 24);
  v6 = v116 ^ *(_DWORD *)(a2 + 4);
  v7 = SS0[(unsigned __int8)(v5 ^ v6 ^ *(_BYTE *)a2)] ^ SS1[(unsigned __int8)((unsigned __int16)(v5 ^ v6 ^ *(_WORD *)a2) >> 8)] ^ SS2[(unsigned __int8)((v5 ^ (unsigned int)v6 ^ *(_DWORD *)a2) >> 16)] ^ SS3[(v5 ^ (unsigned int)v6 ^ *(_DWORD *)a2) >> 24];
  v8 = SS0[(unsigned __int8)(v7 + v6)] ^ SS1[(unsigned __int8)((unsigned __int16)(v7 + v6) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v7 + v6) >> 16)] ^ SS3[(unsigned int)(v7 + v6) >> 24];
  v9 = SS0[(unsigned __int8)(v8 + v7)] ^ SS1[(unsigned __int8)((unsigned __int16)(v8 + v7) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v8 + v7) >> 16)] ^ SS3[(unsigned int)(v8 + v7) >> 24];
  v10 = v9 ^ v3;
  v11 = (v9 + v8) ^ v125;
  v12 = *(_DWORD *)(a2 + 8);
  v126 = v11;
  v13 = v11 ^ *(_DWORD *)(a2 + 12);
  v14 = SS0[(unsigned __int8)(v10 ^ v13 ^ v12)] ^ SS1[(unsigned __int8)((unsigned __int16)(v10 ^ v13 ^ v12) >> 8)] ^ SS2[(unsigned __int8)((v10 ^ v13 ^ v12) >> 16)] ^ SS3[(v10 ^ v13 ^ v12) >> 24];
  v15 = SS0[(unsigned __int8)(v14 + v13)] ^ SS1[(unsigned __int8)((unsigned __int16)(v14 + v13) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v14 + v13) >> 16)] ^ SS3[(unsigned int)(v14 + v13) >> 24];
  v16 = SS0[(unsigned __int8)(v15 + v14)] ^ SS1[(unsigned __int8)((unsigned __int16)(v15 + v14) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v15 + v14) >> 16)] ^ SS3[(unsigned int)(v15 + v14) >> 24];
  v17 = v16 ^ v5;
  v18 = (v16 + v15) ^ v116;
  v19 = *(_DWORD *)(a2 + 16);
  v117 = v18;
  v20 = v18 ^ *(_DWORD *)(a2 + 20);
  v21 = SS0[(unsigned __int8)(v17 ^ v20 ^ v19)] ^ SS1[(unsigned __int8)((unsigned __int16)(v17 ^ v20 ^ v19) >> 8)] ^ SS2[(unsigned __int8)((v17 ^ v20 ^ v19) >> 16)] ^ SS3[(v17 ^ v20 ^ v19) >> 24];
  v22 = SS0[(unsigned __int8)(v21 + v20)] ^ SS1[(unsigned __int8)((unsigned __int16)(v21 + v20) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v21 + v20) >> 16)] ^ SS3[(unsigned int)(v21 + v20) >> 24];
  v23 = SS0[(unsigned __int8)(v22 + v21)] ^ SS1[(unsigned __int8)((unsigned __int16)(v22 + v21) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v22 + v21) >> 16)] ^ SS3[(unsigned int)(v22 + v21) >> 24];
  v24 = v23 ^ v10;
  v25 = (v23 + v22) ^ v126;
  v26 = *(_DWORD *)(a2 + 24);
  v127 = v25;
  v27 = v25 ^ *(_DWORD *)(a2 + 28);
  v28 = SS0[(unsigned __int8)(v24 ^ v27 ^ v26)] ^ SS1[(unsigned __int8)((unsigned __int16)(v24 ^ v27 ^ v26) >> 8)] ^ SS2[(unsigned __int8)((v24 ^ v27 ^ v26) >> 16)] ^ SS3[(v24 ^ v27 ^ v26) >> 24];
  v29 = SS0[(unsigned __int8)(v28 + v27)] ^ SS1[(unsigned __int8)((unsigned __int16)(v28 + v27) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v28 + v27) >> 16)] ^ SS3[(unsigned int)(v28 + v27) >> 24];
  v30 = SS0[(unsigned __int8)(v29 + v28)] ^ SS1[(unsigned __int8)((unsigned __int16)(v29 + v28) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v29 + v28) >> 16)] ^ SS3[(unsigned int)(v29 + v28) >> 24];
  v31 = v30 ^ v17;
  v32 = (v30 + v29) ^ v117;
  v33 = *(_DWORD *)(a2 + 32);
  v118 = v32;
  v34 = v32 ^ *(_DWORD *)(a2 + 36);
  v35 = SS0[(unsigned __int8)(v31 ^ v34 ^ v33)] ^ SS1[(unsigned __int8)((unsigned __int16)(v31 ^ v34 ^ v33) >> 8)] ^ SS2[(unsigned __int8)((v31 ^ v34 ^ v33) >> 16)] ^ SS3[(v31 ^ v34 ^ v33) >> 24];
  v36 = SS0[(unsigned __int8)(v35 + v34)] ^ SS1[(unsigned __int8)((unsigned __int16)(v35 + v34) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v35 + v34) >> 16)] ^ SS3[(unsigned int)(v35 + v34) >> 24];
  v37 = SS0[(unsigned __int8)(v36 + v35)] ^ SS1[(unsigned __int8)((unsigned __int16)(v36 + v35) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v36 + v35) >> 16)] ^ SS3[(unsigned int)(v36 + v35) >> 24];
  v38 = v37 ^ v24;
  v39 = (v37 + v36) ^ v127;
  v40 = *(_DWORD *)(a2 + 40);
  v128 = v39;
  v41 = v39 ^ *(_DWORD *)(a2 + 44);
  v42 = SS0[(unsigned __int8)(v38 ^ v41 ^ v40)] ^ SS1[(unsigned __int8)((unsigned __int16)(v38 ^ v41 ^ v40) >> 8)] ^ SS2[(unsigned __int8)((v38 ^ v41 ^ v40) >> 16)] ^ SS3[(v38 ^ v41 ^ v40) >> 24];
  v43 = SS0[(unsigned __int8)(v42 + v41)] ^ SS1[(unsigned __int8)((unsigned __int16)(v42 + v41) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v42 + v41) >> 16)] ^ SS3[(unsigned int)(v42 + v41) >> 24];
  v44 = SS0[(unsigned __int8)(v43 + v42)] ^ SS1[(unsigned __int8)((unsigned __int16)(v43 + v42) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v43 + v42) >> 16)] ^ SS3[(unsigned int)(v43 + v42) >> 24];
  v45 = v44 ^ v31;
  v46 = (v44 + v43) ^ v118;
  v47 = *(_DWORD *)(a2 + 48);
  v119 = v46;
  v48 = v46 ^ *(_DWORD *)(a2 + 52);
  v49 = SS0[(unsigned __int8)(v45 ^ v48 ^ v47)] ^ SS1[(unsigned __int8)((unsigned __int16)(v45 ^ v48 ^ v47) >> 8)] ^ SS2[(unsigned __int8)((v45 ^ v48 ^ v47) >> 16)] ^ SS3[(v45 ^ v48 ^ v47) >> 24];
  v50 = SS0[(unsigned __int8)(v49 + v48)] ^ SS1[(unsigned __int8)((unsigned __int16)(v49 + v48) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v49 + v48) >> 16)] ^ SS3[(unsigned int)(v49 + v48) >> 24];
  v51 = SS0[(unsigned __int8)(v50 + v49)] ^ SS1[(unsigned __int8)((unsigned __int16)(v50 + v49) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v50 + v49) >> 16)] ^ SS3[(unsigned int)(v50 + v49) >> 24];
  v52 = v51 ^ v38;
  v53 = (v51 + v50) ^ v128;
  v54 = *(_DWORD *)(a2 + 56);
  v129 = v53;
  v55 = v53 ^ *(_DWORD *)(a2 + 60);
  v56 = SS0[(unsigned __int8)(v52 ^ v55 ^ v54)] ^ SS1[(unsigned __int8)((unsigned __int16)(v52 ^ v55 ^ v54) >> 8)] ^ SS2[(unsigned __int8)((v52 ^ v55 ^ v54) >> 16)] ^ SS3[(v52 ^ v55 ^ v54) >> 24];
  v57 = SS0[(unsigned __int8)(v56 + v55)] ^ SS1[(unsigned __int8)((unsigned __int16)(v56 + v55) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v56 + v55) >> 16)] ^ SS3[(unsigned int)(v56 + v55) >> 24];
  v58 = SS0[(unsigned __int8)(v57 + v56)] ^ SS1[(unsigned __int8)((unsigned __int16)(v57 + v56) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v57 + v56) >> 16)] ^ SS3[(unsigned int)(v57 + v56) >> 24];
  v59 = v58 ^ v45;
  v60 = (v58 + v57) ^ v119;
  v61 = *(_DWORD *)(a2 + 64);
  v120 = v60;
  v62 = v60 ^ *(_DWORD *)(a2 + 68);
  v63 = SS0[(unsigned __int8)(v59 ^ v62 ^ v61)] ^ SS1[(unsigned __int8)((unsigned __int16)(v59 ^ v62 ^ v61) >> 8)] ^ SS2[(unsigned __int8)((v59 ^ v62 ^ v61) >> 16)] ^ SS3[(v59 ^ v62 ^ v61) >> 24];
  v64 = SS0[(unsigned __int8)(v63 + v62)] ^ SS1[(unsigned __int8)((unsigned __int16)(v63 + v62) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v63 + v62) >> 16)] ^ SS3[(unsigned int)(v63 + v62) >> 24];
  v65 = SS0[(unsigned __int8)(v64 + v63)] ^ SS1[(unsigned __int8)((unsigned __int16)(v64 + v63) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v64 + v63) >> 16)] ^ SS3[(unsigned int)(v64 + v63) >> 24];
  v66 = v65 ^ v52;
  v67 = (v65 + v64) ^ v129;
  v68 = *(_DWORD *)(a2 + 72);
  v130 = v67;
  v69 = v67 ^ *(_DWORD *)(a2 + 76);
  v70 = SS0[(unsigned __int8)(v66 ^ v69 ^ v68)] ^ SS1[(unsigned __int8)((unsigned __int16)(v66 ^ v69 ^ v68) >> 8)] ^ SS2[(unsigned __int8)((v66 ^ v69 ^ v68) >> 16)] ^ SS3[(v66 ^ v69 ^ v68) >> 24];
  v71 = SS0[(unsigned __int8)(v70 + v69)] ^ SS1[(unsigned __int8)((unsigned __int16)(v70 + v69) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v70 + v69) >> 16)] ^ SS3[(unsigned int)(v70 + v69) >> 24];
  v72 = SS0[(unsigned __int8)(v71 + v70)] ^ SS1[(unsigned __int8)((unsigned __int16)(v71 + v70) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v71 + v70) >> 16)] ^ SS3[(unsigned int)(v71 + v70) >> 24];
  v73 = v72 ^ v59;
  v74 = (v72 + v71) ^ v120;
  v75 = *(_DWORD *)(a2 + 80);
  v121 = v74;
  v76 = v74 ^ *(_DWORD *)(a2 + 84);
  v77 = SS0[(unsigned __int8)(v73 ^ v76 ^ v75)] ^ SS1[(unsigned __int8)((unsigned __int16)(v73 ^ v76 ^ v75) >> 8)] ^ SS2[(unsigned __int8)((v73 ^ v76 ^ v75) >> 16)] ^ SS3[(v73 ^ v76 ^ v75) >> 24];
  v78 = SS0[(unsigned __int8)(v77 + v76)] ^ SS1[(unsigned __int8)((unsigned __int16)(v77 + v76) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v77 + v76) >> 16)] ^ SS3[(unsigned int)(v77 + v76) >> 24];
  v79 = SS0[(unsigned __int8)(v78 + v77)] ^ SS1[(unsigned __int8)((unsigned __int16)(v78 + v77) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v78 + v77) >> 16)] ^ SS3[(unsigned int)(v78 + v77) >> 24];
  v80 = v79 ^ v66;
  v81 = (v79 + v78) ^ v130;
  v82 = *(_DWORD *)(a2 + 88);
  v131 = v81;
  v83 = v81 ^ *(_DWORD *)(a2 + 92);
  v84 = SS0[(unsigned __int8)(v80 ^ v83 ^ v82)] ^ SS1[(unsigned __int8)((unsigned __int16)(v80 ^ v83 ^ v82) >> 8)] ^ SS2[(unsigned __int8)((v80 ^ v83 ^ v82) >> 16)] ^ SS3[(v80 ^ v83 ^ v82) >> 24];
  v85 = SS0[(unsigned __int8)(v84 + v83)] ^ SS1[(unsigned __int8)((unsigned __int16)(v84 + v83) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v84 + v83) >> 16)] ^ SS3[(unsigned int)(v84 + v83) >> 24];
  v86 = SS0[(unsigned __int8)(v85 + v84)] ^ SS1[(unsigned __int8)((unsigned __int16)(v85 + v84) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v85 + v84) >> 16)] ^ SS3[(unsigned int)(v85 + v84) >> 24];
  v87 = v86 ^ v73;
  v88 = (v86 + v85) ^ v121;
  v89 = *(_DWORD *)(a2 + 96);
  v122 = v88;
  v90 = v88 ^ *(_DWORD *)(a2 + 100);
  v91 = SS0[(unsigned __int8)(v87 ^ v90 ^ v89)] ^ SS1[(unsigned __int8)((unsigned __int16)(v87 ^ v90 ^ v89) >> 8)] ^ SS2[(unsigned __int8)((v87 ^ v90 ^ v89) >> 16)] ^ SS3[(v87 ^ v90 ^ v89) >> 24];
  v92 = SS0[(unsigned __int8)(v91 + v90)] ^ SS1[(unsigned __int8)((unsigned __int16)(v91 + v90) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v91 + v90) >> 16)] ^ SS3[(unsigned int)(v91 + v90) >> 24];
  v93 = SS0[(unsigned __int8)(v92 + v91)] ^ SS1[(unsigned __int8)((unsigned __int16)(v92 + v91) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v92 + v91) >> 16)] ^ SS3[(unsigned int)(v92 + v91) >> 24];
  v94 = v93 ^ v80;
  v95 = (v93 + v92) ^ v131;
  v96 = *(_DWORD *)(a2 + 104);
  v132 = v95;
  v97 = v95 ^ *(_DWORD *)(a2 + 108);
  v98 = SS0[(unsigned __int8)(v94 ^ v97 ^ v96)] ^ SS1[(unsigned __int8)((unsigned __int16)(v94 ^ v97 ^ v96) >> 8)] ^ SS2[(unsigned __int8)((v94 ^ v97 ^ v96) >> 16)] ^ SS3[(v94 ^ v97 ^ v96) >> 24];
  v99 = SS0[(unsigned __int8)(v98 + v97)] ^ SS1[(unsigned __int8)((unsigned __int16)(v98 + v97) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v98 + v97) >> 16)] ^ SS3[(unsigned int)(v98 + v97) >> 24];
  v100 = SS0[(unsigned __int8)(v99 + v98)] ^ SS1[(unsigned __int8)((unsigned __int16)(v99 + v98) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v99 + v98) >> 16)] ^ SS3[(unsigned int)(v99 + v98) >> 24];
  v101 = v100 ^ v87;
  v102 = (v100 + v99) ^ v122;
  v103 = *(_DWORD *)(a2 + 112);
  v123 = v102;
  v104 = v102 ^ *(_DWORD *)(a2 + 116);
  v105 = SS0[(unsigned __int8)(v101 ^ v104 ^ v103)] ^ SS1[(unsigned __int8)((unsigned __int16)(v101 ^ v104 ^ v103) >> 8)] ^ SS2[(unsigned __int8)((v101 ^ v104 ^ v103) >> 16)] ^ SS3[(v101 ^ v104 ^ v103) >> 24];
  v106 = SS0[(unsigned __int8)(v105 + v104)] ^ SS1[(unsigned __int8)((unsigned __int16)(v105 + v104) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v105 + v104) >> 16)] ^ SS3[(unsigned int)(v105 + v104) >> 24];
  v107 = SS0[(unsigned __int8)(v106 + v105)] ^ SS1[(unsigned __int8)((unsigned __int16)(v106 + v105) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v106 + v105) >> 16)] ^ SS3[(unsigned int)(v106 + v105) >> 24];
  v108 = v107 ^ v94;
  v109 = *(_DWORD *)(a2 + 120);
  v133 = (v107 + v106) ^ v132;
  v110 = v133 ^ *(_DWORD *)(a2 + 124);
  v111 = SS0[(unsigned __int8)(v108 ^ v110 ^ v109)] ^ SS1[(unsigned __int8)((unsigned __int16)(v108 ^ v110 ^ v109) >> 8)] ^ SS2[(unsigned __int8)((v108 ^ v110 ^ v109) >> 16)] ^ SS3[(v108 ^ v110 ^ v109) >> 24];
  v112 = SS0[(unsigned __int8)(v111 + v110)] ^ SS1[(unsigned __int8)((unsigned __int16)(v111 + v110) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v111 + v110) >> 16)] ^ SS3[(unsigned int)(v111 + v110) >> 24];
  v113 = SS0[(unsigned __int8)(v112 + v111)] ^ SS1[(unsigned __int8)((unsigned __int16)(v112 + v111) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v112 + v111) >> 16)] ^ SS3[(unsigned int)(v112 + v111) >> 24];
  v114 = v113 ^ v101;
  *a1 = HIBYTE(v114);
  v124 = (v113 + v112) ^ v123;
  a1[1] = BYTE2(v114);
  a1[2] = BYTE1(v114);
  a1[3] = v114;
  a1[4] = HIBYTE(v124);
  a1[5] = BYTE2(v124);
  a1[6] = BYTE1(v124);
  a1[7] = v124;
  a1[8] = HIBYTE(v108);
  a1[9] = BYTE2(v108);
  a1[10] = BYTE1(v108);
  a1[11] = v108;
  a1[12] = HIBYTE(v133);
  a1[13] = BYTE2(v133);
  result = a1 + 14;
  a1[14] = BYTE1(v133);
  a1[15] = v133;
  return result;
}

//----- (0000336C) --------------------------------------------------------
int __cdecl PPDecryptServerPacket(unsigned __int8 *a1, unsigned int a2)
{
  unsigned int v2; // esi
  unsigned __int8 *v3; // ebx
  unsigned __int16 v4; // cx
  int v5; // edi
  int v6; // esi
  unsigned __int16 v7; // dx
  int result; // eax
  int v9; // edx

  v2 = a2;
  dwPPLastError = 0;
  SeedDecrypt((int)a1, a2, serverRoundKey);
  v3 = &a1[v2 - 16];
  LOBYTE(v4) = 0;
  HIBYTE(v4) = v3[6];
  v5 = v3[7] | v4 | (v3[5] << 16) | (v3[4] << 24);
  LOBYTE(v4) = 0;
  HIBYTE(v4) = v3[10];
  v6 = v3[11] | v4 | (v3[9] << 16) | (v3[8] << 24);
  HIBYTE(v7) = v3[14];
  LOBYTE(v7) = v3[15];
  if ( ((v3[13] << 16) | (v3[12] << 24) | v7) == (unsigned __int16)serverKeyId )
  {
    v9 = v3[11] & 0xF;
    a2 = 0;
    CFvCrc32::Crc32Mem((CFvCrc32 *)&crc, a1, v6 - v9 + 20, &a2);
    if ( v5 == a2 )
    {
      result = v6;
      *(_DWORD *)v3 = 0;
      *((_DWORD *)v3 + 1) = 0;
      *((_DWORD *)v3 + 2) = 0;
      *((_DWORD *)v3 + 3) = 0;
    }
    else
    {
      dwPPLastError = 4;
      result = 0;
    }
  }
  else
  {
    dwPPLastError = 1;
    result = 0;
  }
  return result;
}
// 504: using guessed type int dwPPLastError;
// 150A: using guessed type __int16 serverKeyId;

//----- (0000346C) --------------------------------------------------------
int __cdecl SeedDecrypt(int a1, int a2, int *a3)
{
  int v3; // esi

  v3 = 0;
  if ( a2 <= 0 )
    return 0;
  do
  {
    SeedDecryptBlock((unsigned __int8 *)(v3 + a1), a3);
    v3 += 16;
  }
  while ( v3 < a2 );
  return v3;
}

//----- (000034AC) --------------------------------------------------------
unsigned __int8 *__cdecl SeedDecryptBlock(unsigned __int8 *a1, int *a2)
{
  unsigned __int16 v2; // dx
  int v3; // ecx
  unsigned __int16 v4; // bx
  int v5; // edx
  int v6; // edi
  int v7; // esi
  int v8; // ebx
  int v9; // edi
  int v10; // ecx
  int v11; // edi
  unsigned int v12; // ebx
  int v13; // edi
  int v14; // esi
  int v15; // ebx
  int v16; // edi
  int v17; // edx
  int v18; // edi
  unsigned int v19; // ebx
  int v20; // edi
  int v21; // esi
  int v22; // ebx
  int v23; // edi
  int v24; // ecx
  int v25; // edi
  unsigned int v26; // ebx
  int v27; // edi
  int v28; // esi
  int v29; // ebx
  int v30; // edi
  int v31; // edx
  int v32; // edi
  unsigned int v33; // ebx
  int v34; // edi
  int v35; // esi
  int v36; // ebx
  int v37; // edi
  int v38; // ecx
  int v39; // edi
  unsigned int v40; // ebx
  int v41; // edi
  int v42; // esi
  int v43; // ebx
  int v44; // edi
  int v45; // edx
  int v46; // edi
  unsigned int v47; // ebx
  int v48; // edi
  int v49; // esi
  int v50; // ebx
  int v51; // edi
  int v52; // ecx
  int v53; // edi
  unsigned int v54; // ebx
  int v55; // edi
  int v56; // esi
  int v57; // ebx
  int v58; // edi
  int v59; // edx
  int v60; // edi
  unsigned int v61; // ebx
  int v62; // edi
  int v63; // esi
  int v64; // ebx
  int v65; // edi
  int v66; // ecx
  int v67; // edi
  unsigned int v68; // ebx
  int v69; // edi
  int v70; // esi
  int v71; // ebx
  int v72; // edi
  int v73; // edx
  int v74; // edi
  unsigned int v75; // ebx
  int v76; // edi
  int v77; // esi
  int v78; // ebx
  int v79; // edi
  int v80; // ecx
  int v81; // edi
  unsigned int v82; // ebx
  int v83; // edi
  int v84; // esi
  int v85; // ebx
  int v86; // edi
  int v87; // edx
  int v88; // edi
  unsigned int v89; // ebx
  int v90; // edi
  int v91; // esi
  int v92; // ebx
  int v93; // edi
  int v94; // ecx
  int v95; // edi
  unsigned int v96; // ebx
  int v97; // edi
  int v98; // esi
  int v99; // ebx
  int v100; // edi
  int v101; // edx
  int v102; // edi
  unsigned int v103; // ebx
  int v104; // edi
  int v105; // esi
  int v106; // ebx
  int v107; // edi
  int v108; // ecx
  unsigned int v109; // eax
  int v110; // edi
  int v111; // esi
  int v112; // eax
  int v113; // edi
  int v114; // edx
  unsigned __int8 *result; // eax
  int v116; // [esp+10h] [ebp-Ch]
  int v117; // [esp+10h] [ebp-Ch]
  int v118; // [esp+10h] [ebp-Ch]
  int v119; // [esp+10h] [ebp-Ch]
  int v120; // [esp+10h] [ebp-Ch]
  int v121; // [esp+10h] [ebp-Ch]
  int v122; // [esp+10h] [ebp-Ch]
  int v123; // [esp+10h] [ebp-Ch]
  int v124; // [esp+10h] [ebp-Ch]
  int v125; // [esp+14h] [ebp-8h]
  int v126; // [esp+14h] [ebp-8h]
  int v127; // [esp+14h] [ebp-8h]
  int v128; // [esp+14h] [ebp-8h]
  int v129; // [esp+14h] [ebp-8h]
  int v130; // [esp+14h] [ebp-8h]
  int v131; // [esp+14h] [ebp-8h]
  int v132; // [esp+14h] [ebp-8h]
  int v133; // [esp+14h] [ebp-8h]

  LOBYTE(v2) = 0;
  HIBYTE(v2) = a1[2];
  v3 = a1[3] | v2 | (a1[1] << 16) | (*a1 << 24);
  LOBYTE(v2) = 0;
  HIBYTE(v2) = a1[6];
  v125 = a1[7] | v2 | (a1[5] << 16) | (a1[4] << 24);
  LOBYTE(v4) = 0;
  HIBYTE(v4) = a1[10];
  v5 = a1[11] | v4 | (a1[9] << 16) | (a1[8] << 24);
  v116 = (a1[13] << 16) | (a1[12] << 24);
  v6 = v116 ^ a2[31];
  v7 = SS0[(unsigned __int8)(v5 ^ v6 ^ *((_BYTE *)a2 + 120))] ^ SS1[(unsigned __int8)((unsigned __int16)(v5 ^ v6 ^ *((_WORD *)a2 + 60)) >> 8)] ^ SS2[(unsigned __int8)((v5 ^ v6 ^ (unsigned int)a2[30]) >> 16)] ^ SS3[(v5 ^ v6 ^ (unsigned int)a2[30]) >> 24];
  v8 = SS0[(unsigned __int8)(v7 + v6)] ^ SS1[(unsigned __int8)((unsigned __int16)(v7 + v6) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v7 + v6) >> 16)] ^ SS3[(unsigned int)(v7 + v6) >> 24];
  v9 = SS0[(unsigned __int8)(v8 + v7)] ^ SS1[(unsigned __int8)((unsigned __int16)(v8 + v7) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v8 + v7) >> 16)] ^ SS3[(unsigned int)(v8 + v7) >> 24];
  v10 = v9 ^ v3;
  v11 = (v9 + v8) ^ v125;
  v12 = a2[28];
  v126 = v11;
  v13 = v11 ^ a2[29];
  v14 = SS0[(unsigned __int8)(v10 ^ v13 ^ v12)] ^ SS1[(unsigned __int8)((unsigned __int16)(v10 ^ v13 ^ v12) >> 8)] ^ SS2[(unsigned __int8)((v10 ^ v13 ^ v12) >> 16)] ^ SS3[(v10 ^ v13 ^ v12) >> 24];
  v15 = SS0[(unsigned __int8)(v14 + v13)] ^ SS1[(unsigned __int8)((unsigned __int16)(v14 + v13) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v14 + v13) >> 16)] ^ SS3[(unsigned int)(v14 + v13) >> 24];
  v16 = SS0[(unsigned __int8)(v15 + v14)] ^ SS1[(unsigned __int8)((unsigned __int16)(v15 + v14) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v15 + v14) >> 16)] ^ SS3[(unsigned int)(v15 + v14) >> 24];
  v17 = v16 ^ v5;
  v18 = (v16 + v15) ^ v116;
  v19 = a2[26];
  v117 = v18;
  v20 = v18 ^ a2[27];
  v21 = SS0[(unsigned __int8)(v17 ^ v20 ^ v19)] ^ SS1[(unsigned __int8)((unsigned __int16)(v17 ^ v20 ^ v19) >> 8)] ^ SS2[(unsigned __int8)((v17 ^ v20 ^ v19) >> 16)] ^ SS3[(v17 ^ v20 ^ v19) >> 24];
  v22 = SS0[(unsigned __int8)(v21 + v20)] ^ SS1[(unsigned __int8)((unsigned __int16)(v21 + v20) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v21 + v20) >> 16)] ^ SS3[(unsigned int)(v21 + v20) >> 24];
  v23 = SS0[(unsigned __int8)(v22 + v21)] ^ SS1[(unsigned __int8)((unsigned __int16)(v22 + v21) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v22 + v21) >> 16)] ^ SS3[(unsigned int)(v22 + v21) >> 24];
  v24 = v23 ^ v10;
  v25 = (v23 + v22) ^ v126;
  v26 = a2[24];
  v127 = v25;
  v27 = v25 ^ a2[25];
  v28 = SS0[(unsigned __int8)(v24 ^ v27 ^ v26)] ^ SS1[(unsigned __int8)((unsigned __int16)(v24 ^ v27 ^ v26) >> 8)] ^ SS2[(unsigned __int8)((v24 ^ v27 ^ v26) >> 16)] ^ SS3[(v24 ^ v27 ^ v26) >> 24];
  v29 = SS0[(unsigned __int8)(v28 + v27)] ^ SS1[(unsigned __int8)((unsigned __int16)(v28 + v27) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v28 + v27) >> 16)] ^ SS3[(unsigned int)(v28 + v27) >> 24];
  v30 = SS0[(unsigned __int8)(v29 + v28)] ^ SS1[(unsigned __int8)((unsigned __int16)(v29 + v28) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v29 + v28) >> 16)] ^ SS3[(unsigned int)(v29 + v28) >> 24];
  v31 = v30 ^ v17;
  v32 = (v30 + v29) ^ v117;
  v33 = a2[22];
  v118 = v32;
  v34 = v32 ^ a2[23];
  v35 = SS0[(unsigned __int8)(v31 ^ v34 ^ v33)] ^ SS1[(unsigned __int8)((unsigned __int16)(v31 ^ v34 ^ v33) >> 8)] ^ SS2[(unsigned __int8)((v31 ^ v34 ^ v33) >> 16)] ^ SS3[(v31 ^ v34 ^ v33) >> 24];
  v36 = SS0[(unsigned __int8)(v35 + v34)] ^ SS1[(unsigned __int8)((unsigned __int16)(v35 + v34) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v35 + v34) >> 16)] ^ SS3[(unsigned int)(v35 + v34) >> 24];
  v37 = SS0[(unsigned __int8)(v36 + v35)] ^ SS1[(unsigned __int8)((unsigned __int16)(v36 + v35) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v36 + v35) >> 16)] ^ SS3[(unsigned int)(v36 + v35) >> 24];
  v38 = v37 ^ v24;
  v39 = (v37 + v36) ^ v127;
  v40 = a2[20];
  v128 = v39;
  v41 = v39 ^ a2[21];
  v42 = SS0[(unsigned __int8)(v38 ^ v41 ^ v40)] ^ SS1[(unsigned __int8)((unsigned __int16)(v38 ^ v41 ^ v40) >> 8)] ^ SS2[(unsigned __int8)((v38 ^ v41 ^ v40) >> 16)] ^ SS3[(v38 ^ v41 ^ v40) >> 24];
  v43 = SS0[(unsigned __int8)(v42 + v41)] ^ SS1[(unsigned __int8)((unsigned __int16)(v42 + v41) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v42 + v41) >> 16)] ^ SS3[(unsigned int)(v42 + v41) >> 24];
  v44 = SS0[(unsigned __int8)(v43 + v42)] ^ SS1[(unsigned __int8)((unsigned __int16)(v43 + v42) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v43 + v42) >> 16)] ^ SS3[(unsigned int)(v43 + v42) >> 24];
  v45 = v44 ^ v31;
  v46 = (v44 + v43) ^ v118;
  v47 = a2[18];
  v119 = v46;
  v48 = v46 ^ a2[19];
  v49 = SS0[(unsigned __int8)(v45 ^ v48 ^ v47)] ^ SS1[(unsigned __int8)((unsigned __int16)(v45 ^ v48 ^ v47) >> 8)] ^ SS2[(unsigned __int8)((v45 ^ v48 ^ v47) >> 16)] ^ SS3[(v45 ^ v48 ^ v47) >> 24];
  v50 = SS0[(unsigned __int8)(v49 + v48)] ^ SS1[(unsigned __int8)((unsigned __int16)(v49 + v48) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v49 + v48) >> 16)] ^ SS3[(unsigned int)(v49 + v48) >> 24];
  v51 = SS0[(unsigned __int8)(v50 + v49)] ^ SS1[(unsigned __int8)((unsigned __int16)(v50 + v49) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v50 + v49) >> 16)] ^ SS3[(unsigned int)(v50 + v49) >> 24];
  v52 = v51 ^ v38;
  v53 = (v51 + v50) ^ v128;
  v54 = a2[16];
  v129 = v53;
  v55 = v53 ^ a2[17];
  v56 = SS0[(unsigned __int8)(v52 ^ v55 ^ v54)] ^ SS1[(unsigned __int8)((unsigned __int16)(v52 ^ v55 ^ v54) >> 8)] ^ SS2[(unsigned __int8)((v52 ^ v55 ^ v54) >> 16)] ^ SS3[(v52 ^ v55 ^ v54) >> 24];
  v57 = SS0[(unsigned __int8)(v56 + v55)] ^ SS1[(unsigned __int8)((unsigned __int16)(v56 + v55) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v56 + v55) >> 16)] ^ SS3[(unsigned int)(v56 + v55) >> 24];
  v58 = SS0[(unsigned __int8)(v57 + v56)] ^ SS1[(unsigned __int8)((unsigned __int16)(v57 + v56) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v57 + v56) >> 16)] ^ SS3[(unsigned int)(v57 + v56) >> 24];
  v59 = v58 ^ v45;
  v60 = (v58 + v57) ^ v119;
  v61 = a2[14];
  v120 = v60;
  v62 = v60 ^ a2[15];
  v63 = SS0[(unsigned __int8)(v59 ^ v62 ^ v61)] ^ SS1[(unsigned __int8)((unsigned __int16)(v59 ^ v62 ^ v61) >> 8)] ^ SS2[(unsigned __int8)((v59 ^ v62 ^ v61) >> 16)] ^ SS3[(v59 ^ v62 ^ v61) >> 24];
  v64 = SS0[(unsigned __int8)(v63 + v62)] ^ SS1[(unsigned __int8)((unsigned __int16)(v63 + v62) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v63 + v62) >> 16)] ^ SS3[(unsigned int)(v63 + v62) >> 24];
  v65 = SS0[(unsigned __int8)(v64 + v63)] ^ SS1[(unsigned __int8)((unsigned __int16)(v64 + v63) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v64 + v63) >> 16)] ^ SS3[(unsigned int)(v64 + v63) >> 24];
  v66 = v65 ^ v52;
  v67 = (v65 + v64) ^ v129;
  v68 = a2[12];
  v130 = v67;
  v69 = v67 ^ a2[13];
  v70 = SS0[(unsigned __int8)(v66 ^ v69 ^ v68)] ^ SS1[(unsigned __int8)((unsigned __int16)(v66 ^ v69 ^ v68) >> 8)] ^ SS2[(unsigned __int8)((v66 ^ v69 ^ v68) >> 16)] ^ SS3[(v66 ^ v69 ^ v68) >> 24];
  v71 = SS0[(unsigned __int8)(v70 + v69)] ^ SS1[(unsigned __int8)((unsigned __int16)(v70 + v69) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v70 + v69) >> 16)] ^ SS3[(unsigned int)(v70 + v69) >> 24];
  v72 = SS0[(unsigned __int8)(v71 + v70)] ^ SS1[(unsigned __int8)((unsigned __int16)(v71 + v70) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v71 + v70) >> 16)] ^ SS3[(unsigned int)(v71 + v70) >> 24];
  v73 = v72 ^ v59;
  v74 = (v72 + v71) ^ v120;
  v75 = a2[10];
  v121 = v74;
  v76 = v74 ^ a2[11];
  v77 = SS0[(unsigned __int8)(v73 ^ v76 ^ v75)] ^ SS1[(unsigned __int8)((unsigned __int16)(v73 ^ v76 ^ v75) >> 8)] ^ SS2[(unsigned __int8)((v73 ^ v76 ^ v75) >> 16)] ^ SS3[(v73 ^ v76 ^ v75) >> 24];
  v78 = SS0[(unsigned __int8)(v77 + v76)] ^ SS1[(unsigned __int8)((unsigned __int16)(v77 + v76) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v77 + v76) >> 16)] ^ SS3[(unsigned int)(v77 + v76) >> 24];
  v79 = SS0[(unsigned __int8)(v78 + v77)] ^ SS1[(unsigned __int8)((unsigned __int16)(v78 + v77) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v78 + v77) >> 16)] ^ SS3[(unsigned int)(v78 + v77) >> 24];
  v80 = v79 ^ v66;
  v81 = (v79 + v78) ^ v130;
  v82 = a2[8];
  v131 = v81;
  v83 = v81 ^ a2[9];
  v84 = SS0[(unsigned __int8)(v80 ^ v83 ^ v82)] ^ SS1[(unsigned __int8)((unsigned __int16)(v80 ^ v83 ^ v82) >> 8)] ^ SS2[(unsigned __int8)((v80 ^ v83 ^ v82) >> 16)] ^ SS3[(v80 ^ v83 ^ v82) >> 24];
  v85 = SS0[(unsigned __int8)(v84 + v83)] ^ SS1[(unsigned __int8)((unsigned __int16)(v84 + v83) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v84 + v83) >> 16)] ^ SS3[(unsigned int)(v84 + v83) >> 24];
  v86 = SS0[(unsigned __int8)(v85 + v84)] ^ SS1[(unsigned __int8)((unsigned __int16)(v85 + v84) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v85 + v84) >> 16)] ^ SS3[(unsigned int)(v85 + v84) >> 24];
  v87 = v86 ^ v73;
  v88 = (v86 + v85) ^ v121;
  v89 = a2[6];
  v122 = v88;
  v90 = v88 ^ a2[7];
  v91 = SS0[(unsigned __int8)(v87 ^ v90 ^ v89)] ^ SS1[(unsigned __int8)((unsigned __int16)(v87 ^ v90 ^ v89) >> 8)] ^ SS2[(unsigned __int8)((v87 ^ v90 ^ v89) >> 16)] ^ SS3[(v87 ^ v90 ^ v89) >> 24];
  v92 = SS0[(unsigned __int8)(v91 + v90)] ^ SS1[(unsigned __int8)((unsigned __int16)(v91 + v90) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v91 + v90) >> 16)] ^ SS3[(unsigned int)(v91 + v90) >> 24];
  v93 = SS0[(unsigned __int8)(v92 + v91)] ^ SS1[(unsigned __int8)((unsigned __int16)(v92 + v91) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v92 + v91) >> 16)] ^ SS3[(unsigned int)(v92 + v91) >> 24];
  v94 = v93 ^ v80;
  v95 = (v93 + v92) ^ v131;
  v96 = a2[4];
  v132 = v95;
  v97 = v95 ^ a2[5];
  v98 = SS0[(unsigned __int8)(v94 ^ v97 ^ v96)] ^ SS1[(unsigned __int8)((unsigned __int16)(v94 ^ v97 ^ v96) >> 8)] ^ SS2[(unsigned __int8)((v94 ^ v97 ^ v96) >> 16)] ^ SS3[(v94 ^ v97 ^ v96) >> 24];
  v99 = SS0[(unsigned __int8)(v98 + v97)] ^ SS1[(unsigned __int8)((unsigned __int16)(v98 + v97) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v98 + v97) >> 16)] ^ SS3[(unsigned int)(v98 + v97) >> 24];
  v100 = SS0[(unsigned __int8)(v99 + v98)] ^ SS1[(unsigned __int8)((unsigned __int16)(v99 + v98) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v99 + v98) >> 16)] ^ SS3[(unsigned int)(v99 + v98) >> 24];
  v101 = v100 ^ v87;
  v102 = (v100 + v99) ^ v122;
  v103 = a2[2];
  v123 = v102;
  v104 = v102 ^ a2[3];
  v105 = SS0[(unsigned __int8)(v101 ^ v104 ^ v103)] ^ SS1[(unsigned __int8)((unsigned __int16)(v101 ^ v104 ^ v103) >> 8)] ^ SS2[(unsigned __int8)((v101 ^ v104 ^ v103) >> 16)] ^ SS3[(v101 ^ v104 ^ v103) >> 24];
  v106 = SS0[(unsigned __int8)(v105 + v104)] ^ SS1[(unsigned __int8)((unsigned __int16)(v105 + v104) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v105 + v104) >> 16)] ^ SS3[(unsigned int)(v105 + v104) >> 24];
  v107 = SS0[(unsigned __int8)(v106 + v105)] ^ SS1[(unsigned __int8)((unsigned __int16)(v106 + v105) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v106 + v105) >> 16)] ^ SS3[(unsigned int)(v106 + v105) >> 24];
  v108 = v107 ^ v94;
  v109 = *a2;
  v133 = (v107 + v106) ^ v132;
  v110 = v133 ^ a2[1];
  v111 = SS0[(unsigned __int8)(v108 ^ v110 ^ v109)] ^ SS1[(unsigned __int8)((unsigned __int16)(v108 ^ v110 ^ v109) >> 8)] ^ SS2[(unsigned __int8)((v108 ^ v110 ^ v109) >> 16)] ^ SS3[(v108 ^ v110 ^ v109) >> 24];
  v112 = SS0[(unsigned __int8)(v111 + v110)] ^ SS1[(unsigned __int8)((unsigned __int16)(v111 + v110) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v111 + v110) >> 16)] ^ SS3[(unsigned int)(v111 + v110) >> 24];
  v113 = SS0[(unsigned __int8)(v112 + v111)] ^ SS1[(unsigned __int8)((unsigned __int16)(v112 + v111) >> 8)] ^ SS2[(unsigned __int8)((unsigned int)(v112 + v111) >> 16)] ^ SS3[(unsigned int)(v112 + v111) >> 24];
  v114 = v113 ^ v101;
  *a1 = HIBYTE(v114);
  v124 = (v113 + v112) ^ v123;
  a1[1] = BYTE2(v114);
  a1[2] = BYTE1(v114);
  a1[3] = v114;
  a1[4] = HIBYTE(v124);
  a1[5] = BYTE2(v124);
  a1[6] = BYTE1(v124);
  a1[7] = v124;
  a1[8] = HIBYTE(v108);
  a1[9] = BYTE2(v108);
  a1[10] = BYTE1(v108);
  a1[11] = v108;
  a1[12] = HIBYTE(v133);
  a1[13] = BYTE2(v133);
  result = a1 + 14;
  a1[14] = BYTE1(v133);
  a1[15] = v133;
  return result;
}

//----- (000043BC) --------------------------------------------------------
int __cdecl PPDecryptClientPacket(unsigned __int8 *a1, unsigned int a2)
{
  unsigned int v2; // esi
  unsigned __int8 *v3; // ebx
  unsigned __int16 v4; // cx
  int v5; // edi
  int v6; // esi
  unsigned __int16 v7; // dx
  int result; // eax

  v2 = a2;
  dwPPLastError = 0;
  SeedDecrypt((int)a1, a2, clientRoundKey);
  v3 = &a1[v2 - 16];
  LOBYTE(v4) = 0;
  HIBYTE(v4) = v3[6];
  v5 = v3[7] | v4 | (v3[5] << 16) | (v3[4] << 24);
  LOBYTE(v4) = 0;
  HIBYTE(v4) = v3[10];
  v6 = v3[11] | v4 | (v3[9] << 16) | (v3[8] << 24);
  HIBYTE(v7) = v3[14];
  LOBYTE(v7) = v3[15];
  if ( ((v3[13] << 16) | (v3[12] << 24) | v7) == (unsigned __int16)clientKeyId )
  {
    a2 = 0;
    CFvCrc32::Crc32Mem((CFvCrc32 *)&crc, a1, v6 - (v6 & 0xF) + 20, &a2);
    if ( v5 == a2 )
    {
      result = v6;
      *(_DWORD *)v3 = 0;
      *((_DWORD *)v3 + 1) = 0;
      *((_DWORD *)v3 + 2) = 0;
      *((_DWORD *)v3 + 3) = 0;
    }
    else
    {
      dwPPLastError = 4;
      result = 0;
    }
  }
  else
  {
    dwPPLastError = 1;
    result = 0;
  }
  return result;
}
// 504: using guessed type int dwPPLastError;
// 1508: using guessed type __int16 clientKeyId;

//----- (000044CC) --------------------------------------------------------
int PPGetLastError()
{
  return dwPPLastError;
}
// 504: using guessed type int dwPPLastError;

// nfuncs=21 queued=14 decompiled=14 lumina nreq=0 worse=0 better=0
// ALL OK, 14 function(s) have been successfully decompiled
